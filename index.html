<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>我的持仓面板 v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="style.css">

</head>

<body>
  <div class="app-shell">
    <header>
      <div class="title-block">
        <h1>我的持仓面板 v2.0</h1>
        <small>实时价格由 TwelveData（美股）+ Yahoo Finance（港股）提供</small>
      </div>

      <div class="pill-group">
        <div class="pill green">
          <div class="pill-dot"></div>
          <span>核心 35%</span> · <span>科技 55%</span> · <span>卫星 10%</span>
        </div>
      </div>
    </header>

    <!-- 顶部卡片 -->
    <section class="top-grid">
      <div class="card">
        <div class="card-header">
          <h2>总市值</h2>
          <div class="badge" id="last-update">更新中...</div>
        </div>
        <div class="card-main">
          <div class="primary-value" id="total-value">0.00</div>
          <div class="secondary">估算成本：<span id="total-cost">0.00</span></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>总盈亏</h2>
          <div class="badge">实时价格估算</div>
        </div>
        <div class="card-main">
          <div class="primary-value" id="total-pnl">0.00</div>
          <div class="secondary">收益率：<span id="total-pnl-pct">0.00%</span></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>仓位数量（估算）</h2>
          <div class="badge">仅成功获取价格的标的</div>
        </div>
        <div class="card-main">
          <div class="primary-value" id="holding-count">0</div>
          <div class="secondary" id="failed-count">0 个标的获取失败</div>
        </div>
      </div>
    </section>

    <!-- 主内容 -->
    <section class="main-grid">
      <div class="card-table">
        <div class="table-header">
          <h3><span class="status-dot"></span> 持仓明细</h3>
          <small>支持多笔买卖，自动计算成本、盈亏</small>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>标的</th>
                <th>数量</th>
                <th>成本价</th>
                <th>现价</th>
                <th>市值</th>
                <th>盈亏</th>
                <th>盈亏%</th>
              </tr>
            </thead>
            <tbody id="position-table-body"></tbody>
          </table>
        </div>
      </div>

      <div class="right-column">

        <!-- 饼图 -->
        <div class="card-chart">
          <div class="chart-header">
            <h3>仓位分布 <span style="font-size:11px;color:#22c55e;">· 深色 · TradingView 风格</span></h3>
            <div class="chart-sub" id="chart-subtext">加载中...</div>
          </div>

          <div class="chart-container">
            <canvas id="allocation-chart"></canvas>
          </div>
        </div>

        <!-- 交易输入 -->
        <div class="card-trade">
          <h3>记录一笔交易</h3>
          <form id="trade-form" class="trade-form">
            <label>股票代码
              <input type="text" id="trade-symbol" placeholder="NVDA / QQQ / 0700">
            </label>

            <label>价格
              <input type="number" id="trade-price" step="0.0001" placeholder="USD 或 HKD">
            </label>

            <label>数量
              <input type="number" id="trade-qty" step="0.01" placeholder="买入正数，卖出负数">
            </label>
          </form>

          <div class="trade-actions">
            <button class="btn-primary" id="btn-submit-trade">提交交易</button>
            <button class="btn-secondary" id="btn-reset-data">重置为 data.json 初始估算</button>
          </div>

          <div class="hint">交易记录保存在浏览器 localStorage，不会上传服务器。</div>
        </div>

      </div>
    </section>

  </div>

  <!-- 引入主脚本 -->
  <script src="main.js"></script>

</body>
</html>
